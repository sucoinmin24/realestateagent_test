<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Í≥µÏù∏Ï§ëÍ∞úÏÇ¨">
    <meta name="theme-color" content="#667eea">
    <title>Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†úÏßë</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px;
        }

        .start-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .start-screen h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        .start-screen p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .select-group {
            margin: 25px 0;
            text-align: left;
        }

        .select-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }

        .select-group select,
        .select-group input {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .select-group select:focus,
        .select-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .select-group input {
            cursor: text;
        }

        #questionCountInput {
            display: none;
            margin-top: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 45px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }

        .menu-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .menu-btn:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .menu-btn:active {
            transform: translateY(0);
        }

        .menu-icon {
            font-size: 28px;
            flex-shrink: 0;
        }

        .menu-label {
            font-size: 17px;
            font-weight: bold;
            color: #333;
            display: block;
        }

        .menu-desc {
            font-size: 13px;
            color: #888;
            display: block;
            margin-top: 2px;
        }

        .back-btn {
            background: none;
            border: none;
            color: #667eea;
            font-size: 15px;
            cursor: pointer;
            padding: 5px 0;
            margin-bottom: 15px;
            text-align: left;
            display: block;
        }

        .back-btn:active {
            opacity: 0.6;
        }

        .question-screen {
            display: none;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .question-number {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .question-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }

        /* Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ */
        .question-image-container {
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .question-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        .question-image.loading {
            min-height: 400px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Ïà´Ïûê Î≤ÑÌäº ÏòÅÏó≠ */
        .number-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .number-btn {
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .number-btn:hover:not(.disabled) {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .number-btn.selected {
            border-color: #667eea;
            background: #f0f4ff;
            color: #667eea;
        }

        .number-btn.correct {
            border-color: #4caf50;
            background: #e8f5e9;
            color: #4caf50;
        }

        .number-btn.wrong {
            border-color: #f44336;
            background: #ffebee;
            color: #f44336;
        }

        .number-btn.disabled {
            pointer-events: none;
            opacity: 0.8;
        }

        .explanation-box {
            margin-top: 25px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 10px;
            border-left: 4px solid #4caf50;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .explanation-box.show {
            display: block;
        }

        .explanation-title {
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .explanation-text {
            color: #333;
            line-height: 1.8;
        }

        .explanation-text ul,
        .chat-bubble ul {
            margin: 6px 0 6px 18px;
            padding: 0;
        }

        .explanation-text li,
        .chat-bubble li {
            margin-bottom: 3px;
        }

        .explanation-text strong,
        .chat-bubble strong {
            color: #2c3e50;
        }

        .explanation-text .katex-display,
        .chat-bubble .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 4px 0;
            margin: 4px 0;
        }

        .explanation-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #888;
            font-size: 14px;
        }

        .explanation-loading .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid #ddd;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            flex-shrink: 0;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .retry-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 18px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
        }

        .retry-btn:active {
            opacity: 0.7;
        }

        .chat-history {
            margin-top: 12px;
        }

        .chat-bubble {
            padding: 10px 14px;
            border-radius: 10px;
            margin-top: 8px;
            font-size: 14px;
            line-height: 1.6;
        }

        .chat-bubble.user {
            background: #667eea;
            color: white;
            margin-left: 40px;
            text-align: right;
        }

        .chat-bubble.ai {
            background: #e8f5e9;
            color: #333;
            margin-right: 40px;
        }

        .followup-box {
            margin-top: 12px;
        }

        .followup-input-wrap {
            display: flex;
            gap: 8px;
        }

        .followup-input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }

        .followup-input:focus {
            border-color: #667eea;
        }

        .followup-btn {
            padding: 10px 18px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }

        .followup-btn:active {
            opacity: 0.7;
        }

        .followup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            gap: 10px;
        }

        .nav-left, .nav-right {
            display: flex;
            gap: 10px;
        }

        .btn-nav {
            padding: 14px 26px;
            font-size: 16px;
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        .btn-home {
            background: #3498db;
        }

        .btn-home:hover {
            background: #2980b9;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-finish {
            background: #e74c3c;
        }

        .btn-finish:hover {
            background: #c0392b;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .result-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .score-display {
            font-size: 72px;
            font-weight: bold;
            color: #667eea;
            margin: 30px 0;
        }

        .score-label {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .score-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .score-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .score-item-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .score-item-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .wrong-answers {
            margin-top: 40px;
            text-align: left;
        }

        .wrong-answers h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .wrong-answer-item {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .wrong-answer-header {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }

        .wrong-answer-explanation {
            color: #333;
            line-height: 1.6;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ffeaa7;
        }

        .explanation-label {
            font-weight: bold;
            color: #4caf50;
            margin-bottom: 5px;
        }

        .image-error {
            text-align: center;
            padding: 40px;
            color: #f44336;
            background: #ffebee;
            border-radius: 10px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .container {
                border-radius: 0;
                min-height: 100vh;
            }

            .content {
                padding: 20px;
            }

            .score-details {
                grid-template-columns: 1fr;
            }

            .score-display {
                font-size: 48px;
            }

            .navigation {
                flex-direction: column;
            }

            .nav-left, .nav-right {
                width: 100%;
            }

            .btn-nav {
                flex: 1;
            }

            .number-buttons {
                grid-template-columns: repeat(5, 1fr);
                gap: 10px;
            }

            .number-btn {
                padding: 15px 10px;
                font-size: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†úÏßë</h1>
            <p id="headerSubtitle">Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò ÎåÄÎπÑ</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="content">
            <!-- Î©îÏù∏ Î©îÎâ¥ -->
            <div class="start-screen" id="mainMenu">
                <h2>Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò ÎåÄÎπÑ Î¨∏Ï†úÏßë</h2>
                <p>
                    ÌïôÏäµ Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.
                </p>

                <div class="menu-buttons">
                    <button class="menu-btn" onclick="selectMode('past')">
                        <span class="menu-icon">üìù</span>
                        <span class="menu-label">Í∏∞Ï∂ú Î¨∏Ï†úÏßë</span>
                        <span class="menu-desc">Ïó∞ÎèÑÎ≥Ñ Ïã§Ï†ú Í∏∞Ï∂úÎ¨∏Ï†ú</span>
                    </button>
                    <button class="menu-btn" onclick="selectMode('mock')">
                        <span class="menu-icon">üéØ</span>
                        <span class="menu-label">Î™®ÏùòÍ≥†ÏÇ¨</span>
                        <span class="menu-desc">Ïã§Ï†Ñ Î™®ÏùòÍ≥†ÏÇ¨</span>
                    </button>
                    <button class="menu-btn" onclick="selectMode('practice')">
                        <span class="menu-icon">üìö</span>
                        <span class="menu-label">ÏùºÎ∞ò Î¨∏Ï†úÏßë</span>
                        <span class="menu-desc">Ï£ºÏ†úÎ≥Ñ Ïó∞ÏäµÎ¨∏Ï†ú</span>
                    </button>
                    <button class="menu-btn" onclick="selectMode('all')">
                        <span class="menu-icon">üî•</span>
                        <span class="menu-label">ALL</span>
                        <span class="menu-desc">Î™®Îì† Î¨∏Ï†ú ÌÜµÌï©</span>
                    </button>
                    <button class="menu-btn" onclick="showSettings()" style="border-color: #ddd;">
                        <span class="menu-icon">‚öôÔ∏è</span>
                        <span class="menu-label">API ÌÇ§ ÏÑ§Ï†ï</span>
                        <span class="menu-desc" id="apiKeyStatus">AI Ìï¥ÏÑ§ Í∏∞Îä•ÏùÑ ÏúÑÌïú API ÌÇ§ Í¥ÄÎ¶¨</span>
                    </button>
                </div>
            </div>

            <!-- API ÌÇ§ ÏÑ§Ï†ï ÌôîÎ©¥ -->
            <div class="start-screen" id="settingsScreen" style="display:none;">
                <button class="back-btn" onclick="closeSettings()">‚Üê Î©îÎâ¥Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                <h2>‚öôÔ∏è API ÌÇ§ ÏÑ§Ï†ï</h2>
                <p>AI Ìï¥ÏÑ§ Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ ÏµúÏÜå 1Í∞úÏùò API ÌÇ§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.<br>ÌÇ§Îäî Ïù¥ Í∏∞Í∏∞ÏóêÎßå Ï†ÄÏû•Îê©ÎãàÎã§.</p>

                <div class="select-group">
                    <label>üîµ Gemini API ÌÇ§ <a href="https://aistudio.google.com/apikey" target="_blank" style="font-size:12px; color:#667eea;">(Î∞úÍ∏âÎ∞õÍ∏∞)</a></label>
                    <input type="password" id="keyGemini" placeholder="AIzaSy..." style="width:100%; padding:12px; border:2px solid #ddd; border-radius:10px; font-size:14px;">
                </div>

                <div class="select-group">
                    <label>üü¢ Groq API ÌÇ§ <a href="https://console.groq.com/keys" target="_blank" style="font-size:12px; color:#667eea;">(Î∞úÍ∏âÎ∞õÍ∏∞)</a></label>
                    <input type="password" id="keyGroq" placeholder="gsk_..." style="width:100%; padding:12px; border:2px solid #ddd; border-radius:10px; font-size:14px;">
                </div>

                <div class="select-group">
                    <label>üü° OpenRouter API ÌÇ§ <a href="https://openrouter.ai/keys" target="_blank" style="font-size:12px; color:#667eea;">(Î∞úÍ∏âÎ∞õÍ∏∞)</a></label>
                    <input type="password" id="keyOpenrouter" placeholder="sk-or-..." style="width:100%; padding:12px; border:2px solid #ddd; border-radius:10px; font-size:14px;">
                </div>

                <button class="btn" onclick="saveApiKeys()" style="margin-top:15px;">üíæ Ï†ÄÏû•</button>
                <button class="btn" onclick="clearApiKeys()" style="margin-top:10px; background: linear-gradient(135deg, #f44336, #e91e63);">üóëÔ∏è Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button>
            </div>

            <!-- ÏãúÏûë ÌôîÎ©¥ (Î™®ÎìúÎ≥Ñ ÏÑ§Ï†ï) -->
            <div class="start-screen" id="startScreen" style="display:none;">
                <button class="back-btn" onclick="goMainMenu()">‚Üê Î©îÎâ¥Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                <h2 id="startTitle">Í∏∞Ï∂ú Î¨∏Ï†úÏßë</h2>
                <p id="startDesc">Í∏∞Ï∂úÎ¨∏Ï†úÎ•º Î∞îÌÉïÏúºÎ°ú ÎßåÎì§Ïñ¥ÏßÑ Î¨∏Ï†úÏßëÏûÖÎãàÎã§.</p>

                <div class="select-group" id="yearSelectGroup">
                    <label for="yearSelect" id="yearLabel">üìÖ ÎÖÑÎèÑ ÏÑ†ÌÉù:</label>
                    <select id="yearSelect">
                        <option value="all">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>
                        <option value="2025">2025ÎÖÑ (Ï†ú36Ìöå)</option>
                        <option value="2024">2024ÎÖÑ (Ï†ú35Ìöå)</option>
                        <option value="2023">2023ÎÖÑ (Ï†ú34Ìöå)</option>
                        <option value="2022">2022ÎÖÑ (Ï†ú33Ìöå)</option>
                        <option value="2021">2021ÎÖÑ (Ï†ú32Ìöå)</option>
                        <option value="2020">2020ÎÖÑ (Ï†ú31Ìöå)</option>
                        <option value="random">üé≤ ÎûúÎç§ (ÎßûÏ∂§Ìòï)</option>
                    </select>
                </div>

                <div class="select-group" id="questionCountInput">
                    <label for="questionCount">Î¨∏Ìï≠ Ïàò ÏûÖÎ†•:</label>
                    <input type="number" id="questionCount" min="5" max="200" value="40" placeholder="Ïòà: 40">
                </div>

                <div class="select-group">
                    <label for="subjectSelect">üìö Í≥ºÎ™© ÏÑ†ÌÉù:</label>
                    <select id="subjectSelect">
                        <option value="all">Ï†ÑÏ≤¥ Í≥ºÎ™© (ÌÜµÌï©)</option>
                        <option value="intro">Î∂ÄÎèôÏÇ∞ÌïôÍ∞úÎ°†</option>
                        <option value="civil">ÎØºÎ≤ï Î∞è ÎØºÏÇ¨ÌäπÎ≥ÑÎ≤ï</option>
                        <option value="broker">Í≥µÏù∏Ï§ëÍ∞úÏÇ¨Î≤ï</option>
                        <option value="public">Î∂ÄÎèôÏÇ∞Í≥µÎ≤ï</option>
                        <option value="disclosure">Î∂ÄÎèôÏÇ∞Í≥µÏãúÎ≤ï Î∞è ÏÑ∏Î≤ï</option>
                    </select>
                </div>

                <button class="btn" onclick="startQuiz()">ÏãúÌóò ÏãúÏûë üöÄ</button>
            </div>

            <!-- Î¨∏Ï†ú ÌôîÎ©¥ -->
            <div class="question-screen" id="questionScreen">
                <div class="question-header">
                    <div class="question-number" id="questionNumber">Î¨∏Ï†ú 1/40</div>
                    <div class="question-stats">
                        <span>‚è±Ô∏è <span id="timer">00:00</span></span>
                        <span id="yearBadge" style="background: #667eea; color: white; padding: 4px 10px; border-radius: 12px; font-size: 13px;"></span>
                        <span id="subjectBadge" style="background: #4caf50; color: white; padding: 4px 10px; border-radius: 12px; font-size: 13px;"></span>
                    </div>
                </div>

                <!-- Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄ -->
                <div class="question-image-container">
                    <img id="questionImage" class="question-image" alt="Î¨∏Ï†ú" />
                </div>

                <!-- Ïà´Ïûê Î≤ÑÌäº (1-5) -->
                <div class="number-buttons" id="numberButtons">
                    <button class="number-btn" onclick="selectAnswer(0)">1</button>
                    <button class="number-btn" onclick="selectAnswer(1)">2</button>
                    <button class="number-btn" onclick="selectAnswer(2)">3</button>
                    <button class="number-btn" onclick="selectAnswer(3)">4</button>
                    <button class="number-btn" onclick="selectAnswer(4)">5</button>
                </div>

                <!-- Ìï¥ÏÑ§ -->
                <div class="explanation-box" id="explanationBox">
                    <div class="explanation-title">üí° Ìï¥ÏÑ§</div>
                    <div class="explanation-text" id="explanationText"></div>
                    <div class="chat-history" id="chatHistory"></div>
                    <div class="followup-box" id="followupBox" style="display:none;">
                        <div class="followup-input-wrap">
                            <input type="text" id="followupInput" class="followup-input" placeholder="Ï∂îÍ∞Ä ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
                            <button class="followup-btn" onclick="sendFollowup()">Ï†ÑÏÜ°</button>
                        </div>
                    </div>
                </div>

                <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
                <div class="navigation">
                    <div class="nav-left">
                        <button class="btn btn-secondary btn-nav" onclick="previousQuestion()" id="prevBtn">‚óÄ Ïù¥Ï†Ñ</button>
                        <button class="btn btn-nav" onclick="nextQuestion()" id="nextBtn">Îã§Ïùå ‚ñ∂</button>
                    </div>
                    <div class="nav-right">
                        <button class="btn btn-home btn-nav" onclick="goHome()">üè† Ìôà</button>
                        <button class="btn btn-finish btn-nav" onclick="finishEarly()">‚èπÔ∏è Ï¢ÖÎ£å</button>
                    </div>
                </div>
            </div>

            <!-- Í≤∞Í≥º ÌôîÎ©¥ -->
            <div class="result-screen" id="resultScreen">
                <h2 class="score-label">ÏµúÏ¢Ö Ï†êÏàò</h2>
                <div class="score-display" id="finalScore">0Ï†ê</div>

                <div class="score-details">
                    <div class="score-item">
                        <div class="score-item-label">Ï¥ù Î¨∏Ï†ú Ïàò</div>
                        <div class="score-item-value" id="totalQuestions">0</div>
                    </div>
                    <div class="score-item">
                        <div class="score-item-label">Ï†ïÎãµ</div>
                        <div class="score-item-value" style="color: #4caf50;" id="correctAnswers">0</div>
                    </div>
                    <div class="score-item">
                        <div class="score-item-label">Ïò§Îãµ</div>
                        <div class="score-item-value" style="color: #f44336;" id="wrongAnswers">0</div>
                    </div>
                </div>

                <div class="wrong-answers" id="wrongAnswersSection">
                    <h3>üìù ÌãÄÎ¶∞ Î¨∏Ï†ú Ìï¥ÏÑ§</h3>
                    <div id="wrongAnswersList"></div>
                </div>

                <button class="btn" onclick="restartQuiz()">Îã§Ïãú ÏãúÏûë üîÑ</button>
            </div>
        </div>
    </div>

    <script>
        // ÎÖÑÎèÑ ÏÑ†ÌÉù Ïãú Î¨∏Ìï≠Ïàò ÏûÖÎ†• ÌïÑÎìú ÌëúÏãú/Ïà®ÍπÄ
        document.getElementById('yearSelect').addEventListener('change', function() {
            const questionCountInput = document.getElementById('questionCountInput');
            if (this.value === 'random') {
                questionCountInput.style.display = 'block';
            } else {
                questionCountInput.style.display = 'none';
            }
        });

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ (Ïù¥ÎØ∏ÏßÄ Í∏∞Î∞ò)
        // ÌååÏùºÎ™Ö Í∑úÏπô: questions/YYYY_C_T_NN.png
        // YYYY: ÎÖÑÎèÑ (2025)
        // C: Ï∞®Ïàò (1=1Ï∞®, 2=2Ï∞®)
        // T: ÍµêÏãú (1=1ÍµêÏãú, 2=2ÍµêÏãú)
        // NN: Î¨∏Ï†úÎ≤àÌò∏ (01-40)
        const questionDatabase = [
            // 2025ÎÖÑ 1Ï∞® 1ÍµêÏãú - Î∂ÄÎèôÏÇ∞ÌïôÍ∞úÎ°† (1-40Î≤à)
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_01.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_02.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_03.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_04.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_05.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_06.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_07.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_08.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_09.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_10.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_11.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_12.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_13.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_14.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_15.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_16.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_17.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_18.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_19.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_20.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_21.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_22.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_23.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_24.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_25.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_26.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_27.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_28.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_29.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_30.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_31.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_32.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_33.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_34.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_35.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_36.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_37.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_38.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_39.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'intro', image: 'questions/2025_1_1_40.png', correct: 0, explanation: ''},
            
            // 2025ÎÖÑ 1Ï∞® 1ÍµêÏãú - ÎØºÎ≤ï (41-80Î≤à)
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_41.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_42.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_43.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_44.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_45.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_46.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_47.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_48.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_49.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_50.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_51.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_52.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_53.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_54.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_55.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_56.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_57.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_58.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_59.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_60.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_61.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_62.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_63.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_64.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_65.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_66.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_67.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_68.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_69.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_70.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_71.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_72.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_73.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_74.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_75.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_76.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_77.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_78.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_79.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'civil', image: 'questions/2025_1_1_80.png', correct: 2, explanation: ''},
            
            // 2025ÎÖÑ 2Ï∞® 1ÍµêÏãú - Í≥µÏù∏Ï§ëÍ∞úÏÇ¨Î≤ï (1-40Î≤à)
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_01.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_02.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_03.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_04.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_05.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_06.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_07.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_08.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_09.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_10.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_11.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_12.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_13.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_14.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_15.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_16.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_17.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_18.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_19.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_20.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_21.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_22.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_23.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_24.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_25.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_26.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_27.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_28.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_29.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_30.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_31.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_32.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_33.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_34.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_35.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_36.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_37.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_38.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_39.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'broker', image: 'questions/2025_2_1_40.png', correct: 1, explanation: ''},

            // 2025ÎÖÑ 2Ï∞® 1ÍµêÏãú - Î∂ÄÎèôÏÇ∞Í≥µÎ≤ï (41-80Î≤à)
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_41.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_42.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_43.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_44.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_45.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_46.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_47.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_48.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_49.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_50.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_51.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_52.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_53.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_54.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_55.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_56.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_57.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_58.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_59.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_60.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_61.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_62.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_63.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_64.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_65.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_66.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_67.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_68.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_69.png', correct: 4, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_70.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_71.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_72.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_73.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_74.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_75.png', correct: 3, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_76.png', correct: 1, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_77.png', correct: 0, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_78.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_79.png', correct: 2, explanation: ''},
            { year: 2025, subject: 'public', image: 'questions/2025_2_1_80.png', correct: 0, explanation: ''},
            
            // 2025ÎÖÑ 2Ï∞® 2ÍµêÏãú - Î∂ÄÎèôÏÇ∞Í≥µÏãúÎ≤ï Î∞è ÏÑ∏Î≤ï (1-40Î≤à)
            { year: 2025, subject: 'disclosure', image: 'questions/2025_2_2_01.png', correct: 0, explanation: ''},

            // 2024ÎÖÑ 1Ï∞® 1ÍµêÏãú - Î∂ÄÎèôÏÇ∞ÌïôÍ∞úÎ°† (1-40Î≤à)
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_01.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_02.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_03.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_04.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_05.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_06.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_07.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_08.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_09.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_10.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_11.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_12.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_13.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_14.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_15.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_16.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_17.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_18.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_19.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_20.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_21.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_22.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_23.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_24.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_25.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_26.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_27.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_28.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_29.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_30.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_31.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_32.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_33.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_34.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_35.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_36.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_37.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_38.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_39.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'intro', image: 'questions/2024_1_1_40.png', correct: 0, explanation: ''},
            
            // 2024ÎÖÑ 1Ï∞® 1ÍµêÏãú - ÎØºÎ≤ï (41-80Î≤à)
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_41.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_42.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_43.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_44.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_45.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_46.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_47.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_48.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_49.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_50.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_51.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_52.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_53.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_54.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_55.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_56.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_57.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_58.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_59.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_60.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_61.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_62.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_63.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_64.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_65.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_66.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_67.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_68.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_69.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_70.png', correct: 4, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_71.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_72.png', correct: 3, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_73.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_74.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_75.png', correct: 2, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_76.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_77.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_78.png', correct: 0, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_79.png', correct: 1, explanation: ''},
            { year: 2024, subject: 'civil', image: 'questions/2024_1_1_80.png', correct: 3, explanation: ''},

            // 2023ÎÖÑ 1Ï∞® 1ÍµêÏãú - Î∂ÄÎèôÏÇ∞ÌïôÍ∞úÎ°† (1-40Î≤à)
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_01.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_02.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_03.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_04.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_05.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_06.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_07.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_08.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_09.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_10.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_11.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_12.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_13.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_14.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_15.png', correct: 0, explanation: '1,2,3,4,5Î≤à Î™®Îëê Ï†ïÎãµ'},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_16.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_17.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_18.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_19.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_20.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_21.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_22.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_23.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_24.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_25.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_26.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_27.png', correct: 0, explanation: '1,2,3,4,5Î≤à Î™®Îëê Ï†ïÎãµ'},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_28.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_29.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_30.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_31.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_32.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_33.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_34.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_35.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_36.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_37.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_38.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_39.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'intro', image: 'questions/2023_1_1_40.png', correct: 0, explanation: ''},
            
            // 2023ÎÖÑ 1Ï∞® 1ÍµêÏãú - ÎØºÎ≤ï (41-80Î≤à)
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_41.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_42.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_43.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_44.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_45.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_46.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_47.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_48.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_49.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_50.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_51.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_52.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_53.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_54.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_55.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_56.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_57.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_58.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_59.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_60.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_61.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_62.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_63.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_64.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_65.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_66.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_67.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_68.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_69.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_70.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_71.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_72.png', correct: 3, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_73.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_74.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_75.png', correct: 4, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_76.png', correct: 2, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_77.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_78.png', correct: 1, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_79.png', correct: 0, explanation: ''},
            { year: 2023, subject: 'civil', image: 'questions/2023_1_1_80.png', correct: 1, explanation: ''},
        ];

        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let questionAnswered = [];
        let startTime;
        let timerInterval;
        let currentMode = 'past'; // past, mock, practice, all

        // Î™®ÏùòÍ≥†ÏÇ¨ Î¨∏Ï†ú DB
        const mockDatabase = [
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_01.png', correct: 3, explanation: 'Ïö©ÎèÑÏùò Îã§ÏñëÏÑ±ÏúºÎ°ú Ïù∏Ìï¥ ÌÜ†ÏßÄÎäî Í≤ΩÏ†úÏ†Å(Ïö©ÎèÑÏ†Å) Í≥µÍ∏âÏùÑ Ìï† Ïàò ÏûàÎã§. Ï¶â, Í∞úÍ∞Ñ„ÜçÎß§Î¶Ω„ÜçÍ∞ÑÏ≤ô Îì±ÏùÑ ÌÜµÌïòÏó¨ ÌÜ†ÏßÄÎ•º Ïö©ÎèÑÎ≥ÄÍ≤ΩÌïòÏó¨ ÌôúÏö©Ìï† Ïàò ÏûàÎã§.'},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_02.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_03.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_04.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_05.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_06.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_07.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_08.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_09.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_10.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_11.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_12.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_13.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_14.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_15.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_16.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_17.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_18.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_19.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_20.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_21.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_22.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_23.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_24.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_25.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_26.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_27.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_28.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_29.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_30.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_31.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_32.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_33.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_34.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_35.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_36.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_37.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_38.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_39.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'intro', image: 'questions/mock_1_1_1_40.png', correct: 0, explanation: ''},
            
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_41.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_42.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_43.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_44.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_45.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_46.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_47.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_48.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_49.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_50.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_51.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_52.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_53.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_54.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_55.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_56.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_57.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_58.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_59.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_60.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_61.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_62.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_63.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_64.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_65.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_66.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_67.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_68.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_69.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_70.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_71.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_72.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_73.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_74.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_75.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_76.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_77.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_78.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_79.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'civil', image: 'questions/mock_1_1_1_80.png', correct: 0, explanation: ''},
            
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_01.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_02.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_03.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_04.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_05.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_06.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_07.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_08.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_09.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_10.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_11.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_12.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_13.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_14.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_15.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_16.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_17.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_18.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_19.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_20.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_21.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_22.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_23.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_24.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_25.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_26.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_27.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_28.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_29.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_30.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_31.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_32.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_33.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_34.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_35.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_36.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_37.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_38.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_39.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'broker', image: 'questions/mock_1_2_1_40.png', correct: 4, explanation: ''},
            
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_41.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_42.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_43.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_44.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_45.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_46.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_47.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_48.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_49.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_50.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_51.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_52.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_53.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_54.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_55.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_56.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_57.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_58.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_59.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_60.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_61.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_62.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_63.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_64.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_65.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_66.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_67.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_68.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_69.png', correct: 1, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_70.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_71.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_72.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_73.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_74.png', correct: 0, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_75.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_76.png', correct: 2, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_77.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_78.png', correct: 3, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_79.png', correct: 4, explanation: ''},
            { year: '1ÌöåÏ∞®', subject: 'public', image: 'questions/mock_1_2_1_80.png', correct: 3, explanation: ''},
        ];

        // ÏùºÎ∞ò Î¨∏Ï†úÏßë DB
        const practiceDatabase = [];

        // Î™®Îìú ÏÑ†ÌÉù
        function selectMode(mode) {
            currentMode = mode;
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';

            const yearGroup = document.getElementById('yearSelectGroup');
            const yearLabel = document.getElementById('yearLabel');
            const startTitle = document.getElementById('startTitle');
            const startDesc = document.getElementById('startDesc');

            if (mode === 'past') {
                startTitle.textContent = 'üìù Í∏∞Ï∂ú Î¨∏Ï†úÏßë';
                startDesc.innerHTML = 'Ïó∞ÎèÑÎ≥Ñ Ïã§Ï†ú Í∏∞Ï∂úÎ¨∏Ï†úÏûÖÎãàÎã§.<br>2023, 2024, 2025ÎÖÑ Î∞òÏòÅ ÏôÑÎ£å.';
                yearGroup.style.display = 'block';
                yearLabel.textContent = 'üìÖ ÎÖÑÎèÑ ÏÑ†ÌÉù:';
                document.getElementById('yearSelect').innerHTML = `
                    <option value="all">Ï†ÑÏ≤¥ ÎÖÑÎèÑ</option>
                    <option value="2025">2025ÎÖÑ (Ï†ú36Ìöå)</option>
                    <option value="2024">2024ÎÖÑ (Ï†ú35Ìöå)</option>
                    <option value="2023">2023ÎÖÑ (Ï†ú34Ìöå)</option>
                    <option value="2022">2022ÎÖÑ (Ï†ú33Ìöå)</option>
                    <option value="2021">2021ÎÖÑ (Ï†ú32Ìöå)</option>
                    <option value="2020">2020ÎÖÑ (Ï†ú31Ìöå)</option>
                    <option value="random">üé≤ ÎûúÎç§ (ÎßûÏ∂§Ìòï)</option>
                `;
                document.getElementById('headerSubtitle').textContent = 'Í∏∞Ï∂ú Î¨∏Ï†úÏßë';
            } else if (mode === 'mock') {
                startTitle.textContent = 'üéØ Î™®ÏùòÍ≥†ÏÇ¨';
                startDesc.innerHTML = 'Ïã§Ï†ÑÏ≤òÎüº ÌíÄÏñ¥Î≥¥Îäî Î™®ÏùòÍ≥†ÏÇ¨ÏûÖÎãàÎã§.';
                yearGroup.style.display = 'block';
                yearLabel.textContent = 'üìã Î™®ÏùòÍ≥†ÏÇ¨:';

                let options = '<option value="all">Ï†ÑÏ≤¥</option>';
                const mockItems = [...new Set(mockDatabase.map(q => q.year))].sort();
                mockItems.forEach(item => {
                    options += `<option value="${item}">${item}</option>`;
                });
                options += '<option value="random">üé≤ ÎûúÎç§ (ÎßûÏ∂§Ìòï)</option>';
                document.getElementById('yearSelect').innerHTML = options;
                document.getElementById('headerSubtitle').textContent = 'Î™®ÏùòÍ≥†ÏÇ¨';
            } else if (mode === 'practice') {
                startTitle.textContent = 'üìö ÏùºÎ∞ò Î¨∏Ï†úÏßë';
                startDesc.innerHTML = 'Ï£ºÏ†úÎ≥Ñ Ïó∞ÏäµÎ¨∏Ï†úÏûÖÎãàÎã§.';
                yearGroup.style.display = 'block';
                yearLabel.textContent = 'üìã Î¨∏Ï†úÏßë:';

                let options = '<option value="all">Ï†ÑÏ≤¥</option>';
                const practiceItems = [...new Set(practiceDatabase.map(q => q.year))].sort();
                practiceItems.forEach(item => {
                    options += `<option value="${item}">${item}</option>`;
                });
                options += '<option value="random">üé≤ ÎûúÎç§ (ÎßûÏ∂§Ìòï)</option>';
                document.getElementById('yearSelect').innerHTML = options;
                document.getElementById('headerSubtitle').textContent = 'ÏùºÎ∞ò Î¨∏Ï†úÏßë';
            } else if (mode === 'all') {
                startTitle.textContent = 'üî• ALL';
                startDesc.innerHTML = 'Í∏∞Ï∂ú + Î™®ÏùòÍ≥†ÏÇ¨ + ÏùºÎ∞ò Î¨∏Ï†ú Î™®Îëê Ìè¨Ìï®.';
                yearGroup.style.display = 'block';
                yearLabel.textContent = 'üìã Î¨∏Ï†úÏßë:';

                // Î™®Îì† DBÏóêÏÑú ÏòµÏÖò ÎèôÏ†Å ÏÉùÏÑ±
                let options = '<option value="all">Ï†ÑÏ≤¥</option>';

                // Í∏∞Ï∂ú ÎÖÑÎèÑ Ï∂îÏ∂ú
                const pastYears = [...new Set(questionDatabase.map(q => q.year))].sort((a, b) => b - a);
                if (pastYears.length > 0) {
                    options += '<optgroup label="üìù Í∏∞Ï∂ú Î¨∏Ï†úÏßë">';
                    const examNames = { 2025: 'Ï†ú36Ìöå', 2024: 'Ï†ú35Ìöå', 2023: 'Ï†ú34Ìöå', 2022: 'Ï†ú33Ìöå', 2021: 'Ï†ú32Ìöå', 2020: 'Ï†ú31Ìöå' };
                    pastYears.forEach(y => {
                        options += `<option value="past_${y}">${y}ÎÖÑ Í∏∞Ï∂ú${examNames[y] ? ' (' + examNames[y] + ')' : ''}</option>`;
                    });
                    options += '</optgroup>';
                }

                // Î™®ÏùòÍ≥†ÏÇ¨ Ìï≠Î™© Ï∂îÏ∂ú
                const mockItems = [...new Set(mockDatabase.map(q => q.year))].sort((a, b) => b - a);
                if (mockItems.length > 0) {
                    options += '<optgroup label="üéØ Î™®ÏùòÍ≥†ÏÇ¨">';
                    mockItems.forEach(y => {
                        options += `<option value="mock_${y}">Î™®ÏùòÍ≥†ÏÇ¨ ${y}</option>`;
                    });
                    options += '</optgroup>';
                }

                // ÏùºÎ∞ò Î¨∏Ï†úÏßë Ìï≠Î™© Ï∂îÏ∂ú
                const practiceItems = [...new Set(practiceDatabase.map(q => q.year))].sort((a, b) => b - a);
                if (practiceItems.length > 0) {
                    options += '<optgroup label="üìö ÏùºÎ∞ò Î¨∏Ï†úÏßë">';
                    practiceItems.forEach(y => {
                        options += `<option value="practice_${y}">Î¨∏Ï†úÏßë ${y}</option>`;
                    });
                    options += '</optgroup>';
                }

                options += '<option value="random">üé≤ ÎûúÎç§ (ÎßûÏ∂§Ìòï)</option>';
                document.getElementById('yearSelect').innerHTML = options;
                document.getElementById('headerSubtitle').textContent = 'ALL';
            }
        }

        // Î©îÏù∏ Î©îÎâ¥Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞
        function goMainMenu() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('headerSubtitle').textContent = 'Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò ÎåÄÎπÑ';
            updateApiKeyStatus();
        }

        // ÏÑ§Ï†ï ÌôîÎ©¥
        function showSettings() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'block';
            document.getElementById('headerSubtitle').textContent = 'API ÌÇ§ ÏÑ§Ï†ï';
            // Í∏∞Ï°¥ ÌÇ§ ÌëúÏãú (ÎßàÏä§ÌÇπ)
            document.getElementById('keyGemini').value = localStorage.getItem('ai_key_gemini') || '';
            document.getElementById('keyGroq').value = localStorage.getItem('ai_key_groq') || '';
            document.getElementById('keyOpenrouter').value = localStorage.getItem('ai_key_openrouter') || '';
        }

        function closeSettings() {
            document.getElementById('settingsScreen').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('headerSubtitle').textContent = 'Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò ÎåÄÎπÑ';
            updateApiKeyStatus();
        }

        function saveApiKeys() {
            const gemini = document.getElementById('keyGemini').value.trim();
            const groq = document.getElementById('keyGroq').value.trim();
            const openrouter = document.getElementById('keyOpenrouter').value.trim();

            if (gemini) localStorage.setItem('ai_key_gemini', gemini);
            else localStorage.removeItem('ai_key_gemini');

            if (groq) localStorage.setItem('ai_key_groq', groq);
            else localStorage.removeItem('ai_key_groq');

            if (openrouter) localStorage.setItem('ai_key_openrouter', openrouter);
            else localStorage.removeItem('ai_key_openrouter');

            alert('API ÌÇ§Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            closeSettings();
        }

        function clearApiKeys() {
            if (!confirm('Î™®Îì† API ÌÇ§Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            localStorage.removeItem('ai_key_gemini');
            localStorage.removeItem('ai_key_groq');
            localStorage.removeItem('ai_key_openrouter');
            document.getElementById('keyGemini').value = '';
            document.getElementById('keyGroq').value = '';
            document.getElementById('keyOpenrouter').value = '';
            alert('API ÌÇ§Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            updateApiKeyStatus();
        }

        function updateApiKeyStatus() {
            const count = [AI_KEYS.gemini, AI_KEYS.groq, AI_KEYS.openrouter].filter(k => k).length;
            const el = document.getElementById('apiKeyStatus');
            if (count > 0) {
                el.textContent = `‚úÖ ${count}Í∞ú ÌÇ§ Îì±Î°ùÎê®`;
                el.style.color = '#4caf50';
            } else {
                el.textContent = '‚ö†Ô∏è API ÌÇ§Î•º Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî';
                el.style.color = '#f44336';
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÉÅÌÉú ÌëúÏãú
        document.addEventListener('DOMContentLoaded', updateApiKeyStatus);

        function startQuiz() {
            const selectedYear = document.getElementById('yearSelect').value;
            const selectedSubject = document.getElementById('subjectSelect').value;
            const questionCount = parseInt(document.getElementById('questionCount').value) || 40;

            // Î™®ÎìúÎ≥Ñ Î¨∏Ï†ú DB ÏÑ†ÌÉù
            let sourceDB;
            if (currentMode === 'past') {
                sourceDB = [...questionDatabase];
            } else if (currentMode === 'mock') {
                sourceDB = [...mockDatabase];
            } else if (currentMode === 'practice') {
                sourceDB = [...practiceDatabase];
            } else {
                // ALL: Î™®Îì† DB Ìï©Ïπ®
                sourceDB = [...questionDatabase, ...mockDatabase, ...practiceDatabase];
            }

            let filteredQuestions = sourceDB;
            
            if (selectedYear !== 'all' && selectedYear !== 'random') {
                // ALL Î™®Îìú: past_2025, mock_1 Îì± Ï†ëÎëêÏÇ¨ Ï≤òÎ¶¨
                if (selectedYear.startsWith('past_')) {
                    const year = selectedYear.replace('past_', '');
                    filteredQuestions = questionDatabase.filter(q => q.year == year);
                } else if (selectedYear.startsWith('mock_')) {
                    const year = selectedYear.replace('mock_', '');
                    filteredQuestions = mockDatabase.filter(q => q.year == year);
                } else if (selectedYear.startsWith('practice_')) {
                    const year = selectedYear.replace('practice_', '');
                    filteredQuestions = practiceDatabase.filter(q => q.year == year);
                } else {
                    filteredQuestions = filteredQuestions.filter(q => q.year == selectedYear);
                }
            }

            if (selectedSubject !== 'all') {
                filteredQuestions = filteredQuestions.filter(q => q.subject === selectedSubject);
            }

            if (selectedYear === 'random') {
                filteredQuestions.sort(() => Math.random() - 0.5);
                filteredQuestions = filteredQuestions.slice(0, questionCount);
            } else {
                filteredQuestions.sort(() => Math.random() - 0.5);
            }

            if (filteredQuestions.length === 0) {
                alert('ÏÑ†ÌÉùÌïú Ï°∞Í±¥Ïóê Ìï¥ÎãπÌïòÎäî Î¨∏Ï†úÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }

            currentQuestions = filteredQuestions;
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuestions.length).fill(null);
            questionAnswered = new Array(currentQuestions.length).fill(false);
            startTime = Date.now();

            if (selectedYear === 'random') {
                document.getElementById('headerSubtitle').textContent = `ÎûúÎç§ Î™®Îìú (${currentQuestions.length}Î¨∏Ï†ú)`;
            } else if (selectedYear === 'all') {
                document.getElementById('headerSubtitle').textContent = '2020-2025ÎÖÑ ÌÜµÌï©';
            } else {
                document.getElementById('headerSubtitle').textContent = `${selectedYear}ÎÖÑ Í∏∞Ï∂ú`;
            }

            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('questionScreen').style.display = 'block';
            
            startTimer();
            displayQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timer').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            const isAnswered = questionAnswered[currentQuestionIndex];
            
            document.getElementById('questionNumber').textContent = 
                `Î¨∏Ï†ú ${currentQuestionIndex + 1}/${currentQuestions.length}`;
            
            document.getElementById('yearBadge').textContent = `${question.year}ÎÖÑ`;

            const subjectNames = {
                intro: 'Î∂ÄÎèôÏÇ∞ÌïôÍ∞úÎ°†',
                civil: 'ÎØºÎ≤ï Î∞è ÎØºÏÇ¨ÌäπÎ≥ÑÎ≤ï',
                broker: 'Í≥µÏù∏Ï§ëÍ∞úÏÇ¨Î≤ï',
                public: 'Î∂ÄÎèôÏÇ∞Í≥µÎ≤ï',
                disclosure: 'Î∂ÄÎèôÏÇ∞Í≥µÏãúÎ≤ï Î∞è ÏÑ∏Î≤ï'
            };
            document.getElementById('subjectBadge').textContent = subjectNames[question.subject] || question.subject;
            
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú
            const imgContainer = document.getElementById('questionImage').parentElement;
            const imgElement = document.getElementById('questionImage');
            
            // Í∏∞Ï°¥ ÏóêÎü¨ Î©îÏãúÏßÄ Ï†úÍ±∞ (ÏûàÎã§Î©¥)
            const existingError = imgContainer.querySelector('.image-error');
            if (existingError) {
                existingError.remove();
            }
            
            // Ïù¥ÎØ∏ÏßÄ ÌëúÏãú Î∞è ÏóêÎü¨ Ìï∏Îì§Îü¨ Ï¥àÍ∏∞Ìôî
            imgElement.style.display = 'block';
            imgElement.src = question.image;
            imgElement.onerror = function() {
                // Ïù¥ÎØ∏ÏßÄ Ïà®Í∏∞Í≥† ÏóêÎü¨ Î©îÏãúÏßÄ Ï∂îÍ∞Ä
                imgElement.style.display = 'none';
                const errorDiv = document.createElement('div');
                errorDiv.className = 'image-error';
                errorDiv.innerHTML = `
                    <h3>‚ö†Ô∏è Ïù¥ÎØ∏ÏßÄÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§</h3>
                    <p>ÌååÏùº: ${question.image}</p>
                    <p style="font-size: 12px; margin-top: 10px;">Ïù¥ÎØ∏ÏßÄ ÌååÏùºÏùÑ questions/ Ìè¥ÎçîÏóê Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.</p>
                `;
                imgContainer.appendChild(errorDiv);
            };
            
            // Î≤ÑÌäº ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            const buttons = document.querySelectorAll('.number-btn');
            buttons.forEach((btn, index) => {
                btn.className = 'number-btn';
                
                if (isAnswered) {
                    btn.classList.add('disabled');
                    if (index === question.correct) {
                        btn.classList.add('correct');
                    } else if (index === userAnswers[currentQuestionIndex]) {
                        btn.classList.add('wrong');
                    }
                } else if (userAnswers[currentQuestionIndex] === index) {
                    btn.classList.add('selected');
                }
            });

            // Ìï¥ÏÑ§ ÌëúÏãú
            const explanationBox = document.getElementById('explanationBox');
            const explanationText = document.getElementById('explanationText');
            
            if (isAnswered) {
                const cached = explanationCache[question.image] || question.explanation;
                explanationText.innerHTML = mdToHtml(cached);
                explanationBox.classList.add('show');

                // Ï±ÑÌåÖ ÌûàÏä§ÌÜ†Î¶¨ Î≥µÏõê
                const chatHistoryEl = document.getElementById('chatHistory');
                chatHistoryEl.innerHTML = '';
                const history = chatHistories[question.image];
                if (history && history.length > 1) {
                    // Ï≤´Î≤àÏß∏Îäî Ìï¥ÏÑ§(Ïù¥ÎØ∏ ÌëúÏãúÎê®), ÎÇòÎ®∏ÏßÄÎßå Î≥µÏõê
                    for (let i = 1; i < history.length; i++) {
                        const bubble = document.createElement('div');
                        bubble.className = 'chat-bubble ' + (history[i].role === 'user' ? 'user' : 'ai');
                        bubble.innerHTML = history[i].role === "ai" ? mdToHtml(history[i].content) : history[i].content;
                        chatHistoryEl.appendChild(bubble);
                    }
                }

                // followup UI
                if (usedModels[question.image]) {
                    showFollowupUI();
                }
            } else {
                explanationBox.classList.remove('show');
                document.getElementById('chatHistory').innerHTML = '';
                document.getElementById('followupBox').style.display = 'none';
            }

            // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // Î≤ÑÌäº ÏÉÅÌÉú
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === currentQuestions.length - 1 ? 'Í≤∞Í≥º Î≥¥Í∏∞ ‚úì' : 'Îã§Ïùå ‚ñ∂';
        }

        // ====== AI Ìï¥ÏÑ§ ÏãúÏä§ÌÖú ======
        const AI_KEYS = {
            get gemini() { return localStorage.getItem('ai_key_gemini') || ''; },
            get groq() { return localStorage.getItem('ai_key_groq') || ''; },
            get openrouter() { return localStorage.getItem('ai_key_openrouter') || ''; }
        };

        function hasAnyApiKey() {
            return AI_KEYS.gemini || AI_KEYS.groq || AI_KEYS.openrouter;
        }

        const explanationCache = {};

        // ÎåÄÌôî ÌûàÏä§ÌÜ†Î¶¨ (Î¨∏Ï†úÎ≥Ñ)
        const chatHistories = {};
        // Ìï¥ÏÑ§ ÏÉùÏÑ±Ïóê ÏÑ±Í≥µÌïú Î™®Îç∏ (Î¨∏Ï†úÎ≥Ñ)
        const usedModels = {};

        // ÎßàÌÅ¨Îã§Ïö¥ ‚Üí HTML Î≥ÄÌôò
        function mdToHtml(text) {
            if (!text) return '';

            // 1Îã®Í≥Ñ: ÏàòÏãùÏùÑ Î®ºÏ†Ä Î≥¥Ìò∏ (placeholderÎ°ú ÏπòÌôò)
            const mathBlocks = [];
            let processed = text;

            if (typeof katex !== 'undefined') {
                // Î∏îÎ°ù ÏàòÏãù: $$ ... $$
                processed = processed.replace(/\$\$([\s\S]*?)\$\$/g, (_, tex) => {
                    try {
                        const rendered = katex.renderToString(tex.trim(), { displayMode: true, throwOnError: false });
                        mathBlocks.push(rendered);
                        return `%%MATH${mathBlocks.length - 1}%%`;
                    } catch (e) { return tex; }
                });
                // Î∏îÎ°ù ÏàòÏãù: \[ ... \]
                processed = processed.replace(/\\\[([\s\S]*?)\\\]/g, (_, tex) => {
                    try {
                        const rendered = katex.renderToString(tex.trim(), { displayMode: true, throwOnError: false });
                        mathBlocks.push(rendered);
                        return `%%MATH${mathBlocks.length - 1}%%`;
                    } catch (e) { return tex; }
                });
                // Ïù∏ÎùºÏù∏ ÏàòÏãù: \( ... \)
                processed = processed.replace(/\\\(([\s\S]*?)\\\)/g, (_, tex) => {
                    try {
                        const rendered = katex.renderToString(tex.trim(), { displayMode: false, throwOnError: false });
                        mathBlocks.push(rendered);
                        return `%%MATH${mathBlocks.length - 1}%%`;
                    } catch (e) { return tex; }
                });
                // Ïù∏ÎùºÏù∏ ÏàòÏãù: $ ... $ (Ìïú Ï§Ñ ÎÇ¥)
                processed = processed.replace(/(?<!\$)\$(?!\$)([^\$\n]+?)\$(?!\$)/g, (_, tex) => {
                    try {
                        const rendered = katex.renderToString(tex.trim(), { displayMode: false, throwOnError: false });
                        mathBlocks.push(rendered);
                        return `%%MATH${mathBlocks.length - 1}%%`;
                    } catch (e) { return tex; }
                });
            }

            // 2Îã®Í≥Ñ: HTML Ïù¥Ïä§ÏºÄÏù¥ÌîÑ + ÎßàÌÅ¨Îã§Ïö¥ Î≥ÄÌôò
            let html = processed
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/^###\s+(.+)$/gm, '<strong>$1</strong>')
                .replace(/^##\s+(.+)$/gm, '<strong>$1</strong>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/(?<!\*)\*(?!\*)(.+?)(?<!\*)\*(?!\*)/g, '<em>$1</em>')
                .replace(/^\s*[-*]\s+(.+)$/gm, '<li>$1</li>')
                .replace(/^\s*\d+\.\s+(.+)$/gm, '<li>$1</li>')
                .replace(/((<li>.*<\/li>\s*)+)/g, '<ul>$1</ul>')
                .replace(/\n/g, '<br>')
                .replace(/(<br>\s*){2,}/g, '<br>')
                .replace(/<br>\s*<ul>/g, '<ul>')
                .replace(/<\/ul>\s*<br>/g, '</ul>');

            // 3Îã®Í≥Ñ: ÏàòÏãù placeholder Î≥µÏõê
            html = html.replace(/%%MATH(\d+)%%/g, (_, idx) => mathBlocks[parseInt(idx)]);

            return html;
        }

        // Ïù¥ÎØ∏ÏßÄ ‚Üí base64
        function imageToBase64(imgEl) {
            const canvas = document.createElement('canvas');
            canvas.width = imgEl.naturalWidth;
            canvas.height = imgEl.naturalHeight;
            canvas.getContext('2d').drawImage(imgEl, 0, 0);
            return canvas.toDataURL('image/jpeg', 0.7).split(',')[1];
        }

        // Ìï¥ÏÑ§ ÌîÑÎ°¨ÌîÑÌä∏
        function buildPrompt(ocrText, correctNum) {
            return `Îã§ÏùåÏùÄ Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†úÏù¥Í≥†, Ï†ïÎãµÏùÄ ${correctNum}Î≤àÏù¥Ïïº.

${ocrText}

Îã§Ïùå Í∑úÏπôÎåÄÎ°ú Ìï¥ÏÑ§ÏùÑ ÏûëÏÑ±Ìï¥:
- 200Ïûê Ïù¥ÎÇ¥Î°ú Í∞ÑÍ≤∞ÌïòÍ≤å (ÏÇ¥Ïßù ÎÑòÏúºÎ©¥ Î¨∏Ïû• ÎßàÎ¨¥Î¶¨)
- Ïôú Ï†ïÎãµÏù¥ Í∑∏Í≤ÉÏù∏ÏßÄ, Ï£ºÏöî Ïò§ÎãµÏùÄ Ïôú ÌãÄÎ¶∞ÏßÄ ÏÑ§Î™Ö
- Î¨∏Ï†ú ÎÇ¥Ïö©ÏùÑ Í∑∏ÎåÄÎ°ú Î∞òÎ≥µÌïòÏßÄ ÎßêÍ∏∞
- Î™®Îì† Îã®Ïñ¥Îäî ÌïúÍµ≠Ïñ¥Î°úÎßå ÏûëÏÑ±
- Î∞òÎßêÎ°ú ÏßßÍ≥† Í∞ÑÍ≤∞ÌïòÍ≤å

Ìï¥ÏÑ§:`;
        }

        // Î∞©Î≤ï1: Gemini Vision (Ïù¥ÎØ∏ÏßÄ ÏßÅÏ†ë Ï†ÑÏÜ° ‚Üí OCR+Ìï¥ÏÑ§ ÌïúÎ≤àÏóê)
        async function tryGeminiVision(base64, correctNum) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${AI_KEYS.gemini}`;
            const prompt = `Ïù¥ Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄÎ•º Î≥¥Í≥† Ìï¥ÏÑ§ÏùÑ ÏûëÏÑ±Ìï¥Ï§ò. Ï†ïÎãµÏùÄ ${correctNum}Î≤àÏù¥Ïïº.

Í∑úÏπô:
- 200Ïûê Ïù¥ÎÇ¥, Î∞òÎßê, Í∞ÑÍ≤∞ÌïòÍ≤å
- Ïôú Ï†ïÎãµÏù¥ Í∑∏Í≤ÉÏù∏ÏßÄ, Ï£ºÏöî Ïò§ÎãµÏùÄ Ïôú ÌãÄÎ¶∞ÏßÄ
- Î¨∏Ï†ú ÎÇ¥Ïö© Î∞òÎ≥µ Í∏àÏßÄ
- ÌïúÍµ≠Ïñ¥Î°úÎßå ÏûëÏÑ±

Ìï¥ÏÑ§:`;

            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { inlineData: { mimeType: 'image/jpeg', data: base64 } },
                            { text: prompt }
                        ]
                    }],
                    generationConfig: { maxOutputTokens: 400 }
                })
            });

            if (!res.ok) {
                const errText = await res.text();
                throw new Error(`Gemini Vision ${res.status}: ${errText.substring(0, 100)}`);
            }
            const data = await res.json();
            if (!data.candidates || !data.candidates[0]) throw new Error('Gemini ÏùëÎãµ ÏóÜÏùå');
            return data.candidates[0].content.parts[0].text.trim();
        }

        // Î∞©Î≤ï2: Gemini OCRÎßå (ÌÖçÏä§Ìä∏ Ï∂îÏ∂úÏö©)
        async function geminiOCR(base64) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${AI_KEYS.gemini}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [
                            { inlineData: { mimeType: 'image/jpeg', data: base64 } },
                            { text: 'Ïù¥ ÏãúÌóò Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄÏùò ÌÖçÏä§Ìä∏Î•º Í∑∏ÎåÄÎ°ú Ï∂îÏ∂úÌï¥. Î¨∏Ï†úÎ≤àÌò∏, Î≥¥Í∏∞, ÏÑ†ÌÉùÏßÄ Î™®Îëê Ìè¨Ìï®. ÏÑ§Î™Ö ÏóÜÏù¥ ÌÖçÏä§Ìä∏Îßå.' }
                        ]
                    }],
                    generationConfig: { maxOutputTokens: 800 }
                })
            });
            if (!res.ok) throw new Error(`OCR Ïã§Ìå® ${res.status}`);
            const data = await res.json();
            if (!data.candidates || !data.candidates[0]) throw new Error('OCR ÏùëÎãµ ÏóÜÏùå');
            return data.candidates[0].content.parts[0].text.trim();
        }

        // Groq Vision Ìò∏Ï∂ú (Ïù¥ÎØ∏ÏßÄ ÏßÅÏ†ë Ï†ÑÏÜ°)
        async function callGroqVision(base64, correctNum) {
            const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${AI_KEYS.groq}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'meta-llama/llama-4-scout-17b-16e-instruct',
                    messages: [{
                        role: 'user',
                        content: [
                            {
                                type: 'image_url',
                                image_url: { url: `data:image/jpeg;base64,${base64}` }
                            },
                            {
                                type: 'text',
                                text: `Ïù¥ Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†úÎ•º Î≥¥Í≥† Ìï¥ÏÑ§ÏùÑ ÏûëÏÑ±Ìï¥Ï§ò. Ï†ïÎãµÏùÄ ${correctNum}Î≤àÏù¥Ïïº.

Í∑úÏπô:
- 200Ïûê Ïù¥ÎÇ¥, Î∞òÎßê, Í∞ÑÍ≤∞ÌïòÍ≤å
- Ïôú Ï†ïÎãµÏù¥ Í∑∏Í≤ÉÏù∏ÏßÄ, Ï£ºÏöî Ïò§ÎãµÏùÄ Ïôú ÌãÄÎ¶∞ÏßÄ
- Î¨∏Ï†ú ÎÇ¥Ïö© Î∞òÎ≥µ Í∏àÏßÄ
- ÌïúÍµ≠Ïñ¥Î°úÎßå ÏûëÏÑ±

Ìï¥ÏÑ§:`
                            }
                        ]
                    }],
                    max_tokens: 400
                })
            });
            if (!res.ok) throw new Error(`Groq Vision ${res.status}`);
            const data = await res.json();
            return data.choices[0].message.content.trim();
        }

        // Groq ÌÖçÏä§Ìä∏ Ìò∏Ï∂ú (OCR ÌÖçÏä§Ìä∏ Í∏∞Î∞ò)
        async function callGroq(prompt) {
            const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${AI_KEYS.groq}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama-3.1-8b-instant',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 400
                })
            });
            if (!res.ok) throw new Error(`Groq ${res.status}`);
            const data = await res.json();
            return data.choices[0].message.content.trim();
        }

        // OpenRouter Ìò∏Ï∂ú
        async function callOpenRouter(prompt) {
            const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${AI_KEYS.openrouter}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'mistralai/mixtral-8x7b-instruct',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 400
                })
            });
            if (!res.ok) throw new Error(`OpenRouter ${res.status}`);
            const data = await res.json();
            return data.choices[0].message.content.trim();
        }

        // Gemini ÌÖçÏä§Ìä∏ Ìï¥ÏÑ§ (OCR ÌÖçÏä§Ìä∏ Í∏∞Î∞ò)
        async function callGeminiText(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${AI_KEYS.gemini}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { maxOutputTokens: 400 }
                })
            });
            if (!res.ok) throw new Error(`Gemini Text ${res.status}`);
            const data = await res.json();
            if (!data.candidates || !data.candidates[0]) throw new Error('Gemini Text ÏùëÎãµ ÏóÜÏùå');
            return data.candidates[0].content.parts[0].text.trim();
        }

        // Î©îÏù∏ Ìï¥ÏÑ§ ÏÉùÏÑ± (Î©ÄÌã∞ Î™®Îç∏ Ìè¥Î∞±)
        async function getAIExplanation(question) {
            const cacheKey = question.image;
            if (explanationCache[cacheKey]) return explanationCache[cacheKey];

            const img = document.getElementById('questionImage');
            if (!img || !img.complete || !img.naturalWidth) {
                throw new Error('Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏïàÎê®');
            }

            const base64 = imageToBase64(img);
            const correctNum = question.correct + 1;
            let ocrText = null;

            // ÏÑ±Í≥µ Ïãú Í≥µÌÜµ Ï≤òÎ¶¨
            function onSuccess(result, modelName) {
                console.log(`‚úÖ ${modelName} ÏÑ±Í≥µ`);
                usedModels[cacheKey] = modelName;
                chatHistories[cacheKey] = [{ role: 'assistant', content: result }];
                explanationCache[cacheKey] = result;
                question.explanation = result;
            }

            // 1Ï∞®: Gemini Vision
            try {
                console.log('1Ï∞®: Gemini Vision ÏãúÎèÑ...');
                const result = await tryGeminiVision(base64, correctNum);
                if (result && result.length > 10) {
                    onSuccess(result, 'geminiVision');
                    return result;
                }
            } catch (e) {
                console.warn('‚ùå Gemini Vision Ïã§Ìå®:', e.message);
            }

            // 2Ï∞®: Groq Vision
            try {
                console.log('2Ï∞®: Groq Vision ÏãúÎèÑ...');
                const result = await callGroqVision(base64, correctNum);
                if (result && result.length > 10) {
                    onSuccess(result, 'groqVision');
                    return result;
                }
            } catch (e) {
                console.warn('‚ùå Groq Vision Ïã§Ìå®:', e.message);
            }

            // 3Ï∞®: OCR Ï∂îÏ∂ú ‚Üí ÌÖçÏä§Ìä∏ Í∏∞Î∞ò Î™®Îç∏Îì§
            try {
                console.log('OCR Ï∂îÏ∂ú ÏãúÎèÑ...');
                ocrText = await geminiOCR(base64);
                console.log('OCR ÏÑ±Í≥µ, Í∏∏Ïù¥:', ocrText.length);
            } catch (e) {
                console.warn('‚ùå OCR Ïã§Ìå®:', e.message);
                ocrText = null;
            }

            if (ocrText && ocrText.length >= 20) {
                const prompt = buildPrompt(ocrText, correctNum);

                // 4Ï∞®: Gemini ÌÖçÏä§Ìä∏
                try {
                    console.log('4Ï∞®: Gemini Text ÏãúÎèÑ...');
                    const result = await callGeminiText(prompt);
                    if (result && result.length > 10) {
                        onSuccess(result, 'geminiText');
                        return result;
                    }
                } catch (e) {
                    console.warn('‚ùå Gemini Text Ïã§Ìå®:', e.message);
                }

                // 5Ï∞®: Groq ÌÖçÏä§Ìä∏
                try {
                    console.log('5Ï∞®: Groq Text ÏãúÎèÑ...');
                    const result = await callGroq(prompt);
                    if (result && result.length > 10) {
                        onSuccess(result, 'groqText');
                        return result;
                    }
                } catch (e) {
                    console.warn('‚ùå Groq Text Ïã§Ìå®:', e.message);
                }

                // 6Ï∞®: OpenRouter
                try {
                    console.log('6Ï∞®: OpenRouter ÏãúÎèÑ...');
                    const result = await callOpenRouter(prompt);
                    if (result && result.length > 10) {
                        onSuccess(result, 'openrouter');
                        return result;
                    }
                } catch (e) {
                    console.warn('‚ùå OpenRouter Ïã§Ìå®:', e.message);
                }
            }

            throw new Error('Î™®Îì† Î™®Îç∏ Ïã§Ìå®');
        }

        // Ï∂îÍ∞Ä ÏßàÎ¨∏ Ï†ÑÏÜ°
        async function sendFollowup() {
            const input = document.getElementById('followupInput');
            const userMsg = input.value.trim();
            if (!userMsg) return;

            if (!hasAnyApiKey()) {
                alert('API ÌÇ§Í∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. ÏÑ§Ï†ïÏóêÏÑú ÌÇ§Î•º Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            const cacheKey = question.image;
            let modelName = usedModels[cacheKey];

            // ÏàòÎèô Ìï¥ÏÑ§Ïù∏ Í≤ΩÏö∞ (AI Ìò∏Ï∂ú ÏóÜÏóàÎçò Í≤ΩÏö∞) ‚Üí ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™®Îç∏ ÏûêÎèô ÏÑ†ÌÉù
            if (!modelName) {
                if (AI_KEYS.groq) modelName = 'groqVision';
                else if (AI_KEYS.openrouter) modelName = 'openrouter';
                else if (AI_KEYS.gemini) modelName = 'geminiVision';
                else return;

                usedModels[cacheKey] = modelName;
                chatHistories[cacheKey] = [{ role: 'assistant', content: question.explanation || '' }];
            }

            // ÏÇ¨Ïö©Ïûê Î©îÏãúÏßÄ ÌëúÏãú
            const chatHistory = document.getElementById('chatHistory');
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble user';
            userBubble.textContent = userMsg;
            chatHistory.appendChild(userBubble);

            // ÏûÖÎ†• Ï¥àÍ∏∞Ìôî & ÎπÑÌôúÏÑ±Ìôî
            input.value = '';
            input.disabled = true;
            document.querySelector('.followup-btn').disabled = true;

            // Î°úÎî© ÌëúÏãú
            const loadingBubble = document.createElement('div');
            loadingBubble.className = 'chat-bubble ai';
            loadingBubble.innerHTML = '<div class="explanation-loading"><div class="spinner"></div>ÎãµÎ≥Ä ÏÉùÏÑ± Ï§ë...</div>';
            chatHistory.appendChild(loadingBubble);

            // ÌûàÏä§ÌÜ†Î¶¨Ïóê Ï∂îÍ∞Ä
            if (!chatHistories[cacheKey]) chatHistories[cacheKey] = [];
            chatHistories[cacheKey].push({ role: 'user', content: userMsg });

            try {
                let aiReply;
                const history = chatHistories[cacheKey];
                const base64 = imageToBase64(document.getElementById('questionImage'));

                if (modelName === 'geminiVision' || modelName === 'geminiText') {
                    // Gemini: ÎåÄÌôî ÌûàÏä§ÌÜ†Î¶¨ Ìè¨Ìï® Ìò∏Ï∂ú
                    const contents = [];
                    // Ï≤´ Î©îÏãúÏßÄÏóê Ïù¥ÎØ∏ÏßÄ Ìè¨Ìï®
                    contents.push({
                        role: 'user',
                        parts: [
                            { inlineData: { mimeType: 'image/jpeg', data: base64 } },
                            { text: 'Ïù¥ Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†úÏóê ÎåÄÌï¥ ÏßàÎ¨∏Ìï†Í≤å.' }
                        ]
                    });
                    history.forEach(msg => {
                        contents.push({
                            role: msg.role === 'assistant' ? 'model' : 'user',
                            parts: [{ text: msg.content }]
                        });
                    });

                    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${AI_KEYS.gemini}`;
                    const res = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents, generationConfig: { maxOutputTokens: 500 } })
                    });
                    if (!res.ok) throw new Error(`Gemini ${res.status}`);
                    const data = await res.json();
                    aiReply = data.candidates[0].content.parts[0].text.trim();

                } else if (modelName === 'groqVision' || modelName === 'groqText') {
                    // Groq: ÎåÄÌôî ÌûàÏä§ÌÜ†Î¶¨ Ìè¨Ìï® Ìò∏Ï∂ú
                    const messages = [];
                    // Ï≤´ Î©îÏãúÏßÄÏóê Ïù¥ÎØ∏ÏßÄ Ìè¨Ìï®
                    messages.push({
                        role: 'user',
                        content: [
                            { type: 'image_url', image_url: { url: `data:image/jpeg;base64,${base64}` } },
                            { type: 'text', text: 'Ïù¥ Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò Î¨∏Ï†úÏóê ÎåÄÌï¥ ÏßàÎ¨∏Ìï†Í≤å.' }
                        ]
                    });
                    history.forEach(msg => {
                        messages.push({ role: msg.role, content: msg.content });
                    });

                    const model = modelName === 'groqVision' ? 'meta-llama/llama-4-scout-17b-16e-instruct' : 'llama-3.1-8b-instant';
                    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AI_KEYS.groq}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ model, messages, max_tokens: 500 })
                    });
                    if (!res.ok) throw new Error(`Groq ${res.status}`);
                    const data = await res.json();
                    aiReply = data.choices[0].message.content.trim();

                } else {
                    // OpenRouter
                    const messages = [];
                    history.forEach(msg => {
                        messages.push({ role: msg.role, content: msg.content });
                    });

                    const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AI_KEYS.openrouter}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'mistralai/mixtral-8x7b-instruct',
                            messages,
                            max_tokens: 500
                        })
                    });
                    if (!res.ok) throw new Error(`OpenRouter ${res.status}`);
                    const data = await res.json();
                    aiReply = data.choices[0].message.content.trim();
                }

                // ÏùëÎãµ ÌëúÏãú
                loadingBubble.innerHTML = '';
                loadingBubble.innerHTML = mdToHtml(aiReply);
                chatHistories[cacheKey].push({ role: 'assistant', content: aiReply });

            } catch (e) {
                console.error('Ï∂îÍ∞Ä ÏßàÎ¨∏ Ïã§Ìå®:', e);
                loadingBubble.innerHTML = '<span style="color:#f44336;">ÎãµÎ≥Ä ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.</span>';
            }

            // ÏûÖÎ†• Îã§Ïãú ÌôúÏÑ±Ìôî
            input.disabled = false;
            document.querySelector('.followup-btn').disabled = false;
            input.focus();

            // Ïä§ÌÅ¨Î°§
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // Ï∂îÍ∞Ä ÏßàÎ¨∏ UI ÌëúÏãú
        function showFollowupUI() {
            document.getElementById('followupBox').style.display = 'block';
            // Enter ÌÇ§Î°ú Ï†ÑÏÜ°
            const input = document.getElementById('followupInput');
            input.onkeydown = (e) => {
                if (e.key === 'Enter') sendFollowup();
            };
        }

        // retry Ìï∏Îì§Îü¨
        function retryExplanation() {
            const question = currentQuestions[currentQuestionIndex];
            const explanationText = document.getElementById('explanationText');
            explanationText.innerHTML = '<div class="explanation-loading"><div class="spinner"></div>AI Ìï¥ÏÑ§ Ïû¨ÏãúÎèÑ Ï§ë...</div>';

            getAIExplanation(question).then((text) => {
                explanationText.innerHTML = mdToHtml(text);
                showFollowupUI();
            }).catch((err) => {
                console.error('AI Ìï¥ÏÑ§ Ïû¨ÏãúÎèÑ Ïã§Ìå®:', err);
                explanationText.innerHTML = '<span style="color:#f44336;">Ìï¥ÏÑ§ÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</span><br><button class="retry-btn" onclick="retryExplanation()">üîÑ Îã§Ïãú ÏãúÎèÑ</button>';
            });
        }

        function selectAnswer(answerIndex) {
            if (questionAnswered[currentQuestionIndex]) {
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            userAnswers[currentQuestionIndex] = answerIndex;
            questionAnswered[currentQuestionIndex] = true;

            // Ï¶âÏãú Ï†ïÎãµ/Ïò§Îãµ ÌëúÏãú
            const buttons = document.querySelectorAll('.number-btn');
            buttons.forEach((btn, index) => {
                btn.classList.add('disabled');
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === answerIndex) {
                    btn.classList.add('wrong');
                }
            });

            // Ìï¥ÏÑ§ ÌëúÏãú
            const explanationBox = document.getElementById('explanationBox');
            const explanationText = document.getElementById('explanationText');
            explanationBox.classList.add('show');

            // Í∏∞Ï°¥ Ìï¥ÏÑ§Ïù¥ ÏûàÏúºÎ©¥ Î∞îÎ°ú ÌëúÏãú, ÏóÜÏúºÎ©¥ AI ÏÉùÏÑ±
            if (question.explanation && question.explanation.trim() !== '') {
                explanationText.innerHTML = mdToHtml(question.explanation);
                showFollowupUI();
            } else {
                explanationText.innerHTML = '<div class="explanation-loading"><div class="spinner"></div>AI Ìï¥ÏÑ§ ÏÉùÏÑ± Ï§ë...</div>';

                getAIExplanation(question).then((text) => {
                    explanationText.innerHTML = mdToHtml(text);
                    showFollowupUI();
                }).catch((err) => {
                    console.error('AI Ìï¥ÏÑ§ Ïã§Ìå®:', err);
                    explanationText.innerHTML = '<span style="color:#f44336;">Ìï¥ÏÑ§ÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</span><br><button class="retry-btn" onclick="retryExplanation()">üîÑ Îã§Ïãú ÏãúÎèÑ</button>';
                });
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function goHome() {
            if (confirm('Ï†ïÎßê ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÏãúÍ≤†ÏäµÎãàÍπå?\nÌòÑÏû¨ÍπåÏßÄÏùò ÏßÑÌñâ ÏÉÅÌô©ÏùÄ Ï†ÄÏû•ÎêòÏßÄ ÏïäÏäµÎãàÎã§.')) {
                clearInterval(timerInterval);
                resetQuiz();
            }
        }

        function finishEarly() {
            if (confirm('ÏãúÌóòÏùÑ Ï¢ÖÎ£åÌïòÍ≥† Í≤∞Í≥ºÎ•º ÌôïÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÎãµÌïòÏßÄ ÏïäÏùÄ Î¨∏Ï†úÎäî Ïò§ÎãµÏúºÎ°ú Ï≤òÎ¶¨Îê©ÎãàÎã§.')) {
                for (let i = 0; i < currentQuestions.length; i++) {
                    if (userAnswers[i] === null) {
                        userAnswers[i] = -1;
                    }
                }
                showResults();
            }
        }

        function showResults() {
            clearInterval(timerInterval);

            let correctCount = 0;
            let wrongQuestions = [];

            userAnswers.forEach((answer, index) => {
                if (answer === currentQuestions[index].correct) {
                    correctCount++;
                } else {
                    wrongQuestions.push({
                        questionNum: index + 1,
                        question: currentQuestions[index],
                        userAnswer: answer
                    });
                }
            });

            const score = Math.round((correctCount / currentQuestions.length) * 100);

            document.getElementById('questionScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';

            document.getElementById('finalScore').textContent = score + 'Ï†ê';
            document.getElementById('totalQuestions').textContent = currentQuestions.length;
            document.getElementById('correctAnswers').textContent = correctCount;
            document.getElementById('wrongAnswers').textContent = wrongQuestions.length;

            const wrongAnswersList = document.getElementById('wrongAnswersList');
            wrongAnswersList.innerHTML = '';

            if (wrongQuestions.length === 0) {
                wrongAnswersList.innerHTML = '<p style="text-align: center; color: #4caf50; font-size: 18px; padding: 40px;">üéâ Î™®Îì† Î¨∏Ï†úÎ•º ÎßûÌòîÏäµÎãàÎã§! ÏôÑÎ≤ΩÌï©ÎãàÎã§!</p>';
            } else {
                wrongQuestions.forEach(wrong => {
                    const wrongDiv = document.createElement('div');
                    wrongDiv.className = 'wrong-answer-item';
                    
                    const userAnswerText = wrong.userAnswer !== null && wrong.userAnswer !== -1
                        ? `${wrong.userAnswer + 1}Î≤à` 
                        : '(ÎãµÏïà ÎØ∏ÏÑ†ÌÉù)';
                    
                    wrongDiv.innerHTML = `
                        <div class="wrong-answer-header">
                            [${wrong.question.year}ÎÖÑ] Î¨∏Ï†ú ${wrong.questionNum}
                        </div>
                        <div style="margin-top: 10px;">
                            <div style="color: #f44336; margin-bottom: 5px;">
                                ‚ùå ÏÑ†ÌÉùÌïú Îãµ: ${userAnswerText}
                            </div>
                            <div style="color: #4caf50; margin-bottom: 5px;">
                                ‚úÖ Ï†ïÎãµ: ${wrong.question.correct + 1}Î≤à
                            </div>
                        </div>
                        <div class="wrong-answer-explanation">
                            <div class="explanation-label">üí° Ìï¥ÏÑ§:</div>
                            ${explanationCache[wrong.question.image] || wrong.question.explanation || 'Ìï¥ÏÑ§ ÏóÜÏùå'}
                        </div>
                    `;
                    wrongAnswersList.appendChild(wrongDiv);
                });
            }
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            questionAnswered = [];
            document.getElementById('questionScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('headerSubtitle').textContent = 'Í≥µÏù∏Ï§ëÍ∞úÏÇ¨ ÏãúÌóò ÎåÄÎπÑ';
            updateApiKeyStatus();
        }

        function restartQuiz() {
            resetQuiz();
        }
    </script>
</body>
</html>